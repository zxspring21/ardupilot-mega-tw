## 自動起飛和降落 ##

作為飛行任務的一部分，ArduPilot Mega 能夠自動起飛和降落。下面說明操作方法:

---

### 自動起飛說明 ###

APM 起飛的基本的想法是將油門開到最大，爬升到預定高度。要讓飛機執行自動起飛，在任務中增加一個 NAV\_TAKEOFF 命令(也許是第一個命令)。根據安裝的感應器不同，達成目標的方法也有少許不同，但是高度參數會使 APM 完成起飛動作，並且在載入下一個命令前應達到預計的高度。

APM 在起飛開始時將保持機翼水平, 但一旦確定起飛方向，APM 將側傾以達到該方向。

**如果你沒有磁力計:**

> 當 GPS 測量的地速超過 3 m/s 時, 起飛方向將設置為 GPS 對地運動方向。這就意味著，當有側風時， APM 可能會朝下風向偏移。某些時候會過早地設定起飛方向，這將使 APM 在起飛過程中將飛機轉向某個非預期的方向。為了減輕這個問題，不要在進入自動模式後移動飛機，除非是將其拋向起飛方向。Try not to "wind up" by moving the plane backwards before throwing it. 盡可能使用彈射發射架，避免該行為。

**如果你有磁力計:**

> 當 GPS 測量的地速超過 3 m/s 時, 起飛方向由磁力計的偏航傳感器確定。

**如果沒有空速傳感器:**

> NAV\_TAKEOFF 命令的第一個參數將指定起飛時最大仰角。最小仰角自動設置為正5度。當飛機速度 (由 GPS 測量) 增加時, 仰角也將增加。公式為:

> 仰角 = (GPS 速度 / 巡航速度) x 最大仰角 / 2

**如果有空速傳感器:**

> NAV\_TAKEOFF 命令的第一個參數將指定起飛時最小仰角。APM 將調整仰角，達到巡航空速 (空速大於巡航空速時時仰角增大，空速小於巡航空速時時仰角減小)，但仰角不會低於 CMD\_TAKEOFF 命令設置的最小仰角。


---


## 自動降落說明 ##


要降落飛機，在任務結尾增加一個 NAV\_LAND 命令，指定降落點的經緯度和高度。多數情況下，高度應該是 0。 在降落過程中，一旦飛機離降落點的水平距離小於 2 秒航程，或者高度低於3米時，APM 將關閉油門並保持當前的航向。

降落過程中，如果有空速傳感器，APM 將用普通方式飛行。如果沒有的話，APM將保持0度仰角。

### 例子 ###

這是一個在 Sparkfun 大樓附近飛行的任務例子。飛機首先自動起飛，圍繞大樓飛行，然後自動降落。注意當飛機起飛爬升到30m後開始按航線飛行，降落的高度則是0（高度是相對於家/起飛點的相對高度）

http://wiki.ardupilot-mega.googlecode.com/git/images/ArduPilotMegaImages/autotakeoff.PNG

請注意，在實際環境中上述的飛行計畫可能無法在需求區域上成功降落。第5航點的高度設為 100 米，第6航點設為降落航點，兩點的距離太近。除非使用特定的飛機當關閉馬達滑行時會產生一個非常快的下降速度，但它也無法在這麼短的距離內下降100米。比較好的方式是用幾個航點慢慢的下降，並且確認每個航點與降落點距離間的高度是足夠的。如果你的飛機有一個相對平坦的下滑角可以使用自動 flap 這個功能會對你有幫助，可以在 "Optional Additions" 裡設置。

---

<a href='Hidden comment: 

This section commented out as it does not apply to the current code - DEW - 3/2/13

=== 如何建置降落模式 ===

http://wiki.ardupilot-mega.googlecode.com/git/images/landing1.png

降落程序由任務配置中的兩個降落命令組成。第一個降落命令是反彈或軌道航點。第二個是著地點。這兩個航點之間的軌道線在飛機進場時應該避開。

http://wiki.ardupilot-mega.googlecode.com/git/images/landing2.png

如果你選出命令列(下例範例的第3個航點)你會看到上面所選中那行的參數名稱就會被刷新。參數名稱會根據您選擇的命令做變更。

http://wiki.ardupilot-mega.googlecode.com/git/images/landing3.png

在上面的圖片中將未使用的參數劃掉(請見下面說明)。

*status*: 這是降落狀態機的邏輯狀態。共有5種降落狀態(0-4)。它都是從零開始(由 AT Planner 設置為零)。使用者可以在這輸入一個大於零的值，並盡可能讓它同步。如果需要的話，你可以在飛行中讀取航點並更新這些數值。它使用一條綠線在上面標示出來，在“進階使用者”有更多參數，成功降落配置文件應該要被設置為0。當它切換到保持追縱時，首次降落命令的狀態參數將會映射到第二個的降落命令。

*Break alt*:  這是飛機停止軌道的高度(單位：米)，並且在最後一段(追縱並保持機鼻約 +- 10 度)會開始排隊。在 *第二個* 降落指令 Break alt 應該會被設置為 0。

*Radius*:  這個半徑(17 米以上)是無人機用於 Alt 參數(63 米以上)下降航道的高度命令，一旦飛機在定義的半徑內(觸發點為 +-2 米)。*第二次*的降落命令因為它無法使用故半徑參數為零。

*Cut alt*:  MSL (20 米以上)油門將會被切到 configuration 頁面中的 IDLE_THROTTLE(電動機通常為零)。*首次*的降落命令會減少 alt 參數到零，因為它沒有被使用。

-----------------






NAV_LAND_OPTIONS 命令的最後三個參數定義了 APM 修正飛行的方式:
* <p>如果沒有空速傳感器，最後一個參數定義 APM 保持的仰角。如果有空速傳感器，該參數無效——取而代之的，APM 將自動控制仰角以保持巡航空速.

Unknown end tag for &lt;/p&gt;


* <p>第三個參數定義了巡航油門的新數值。巡航油門是保持平衡的一個閾值。如果飛機處於正確的高度(和速度，如果有空速傳感器), 油門將設為巡航油門。偏離平衡（例如飛機略高了一些)將導致油門偏離巡航油門值。巡航油門設低一些將導致飛機的能量減小，這也正是降落過程所希望的。如果有空速傳感器, 巡航油門應當與巡航空速一起改變，才能獲得良好的飛行特性。

Unknown end tag for &lt;/p&gt;


* <p>第二個參數定義了巡航空速的新數值。但如果沒有空速傳感器的話，該參數無效。(除非在起飛過程中)。如果有空速傳感器, 該參數應該與巡航油門相匹配。也就是說，在水平直線飛行時，飛機在特定的油門設定下保持相應的空速。你應當將巡航空速設為飛機在這個 NAV_LAND_OPTIONS 命令設定的巡航油門下水平直線飛行觀察到的空速。

Unknown end tag for &lt;/p&gt;



*注:* 如果你用雙向地面站（例如調試終端）在飛行時維護飛機的任務，記住在飛機執行完 NAV_LAND_OPTIONS 命令後不會恢復巡航油門和巡航空速值。

因為 NAV_LAND_OPTIONS 是一個 2 級"可能的"命令, 它將在執行完一個"必須的"任務（本例中為 NAV_LAND）後立即執行。它將阻塞後續的"可能的"命令，直至 APM 到達離下一個航點（本例中，航點由 NAV_LAND 定義）特定的距離（NAV_LAND_OPTIONS 命令的第一個參數，單位為米）之內。因此，如果 NAV_LAND_OPTIONS 命令的第一個參數為 0，那麼所有後續"可能的"命令都將阻塞，因為 APM 永遠不會離目標航點 0 米之內。如果第一個參數是除 0 之外的其它值，一旦 APM 離目標航點距離在該值一下，就認為 NAV_LAND_OPTIONS 命令執行完畢。因此，一條 NAV_LAND 命令可以多次更改飛行行為。


帶有空速傳感器的降落命令看起來像這樣:

```
NAV_LAND: p1 = 0, alt = 0, lat = 34.158121, -118.166592
NAV_LAND_OPTIONS: p1 = 150, p2 = 15, p3 = 75, p4 = N/A
NAV_LAND_OPTIONS: p1 = 50, p2 = 13, p3 = 65, p4 = N/A
NAV_LAND_OPTIONS: p1 = 0, p2 = 10, p3 = 45, p4 = N/A
```

在這個任務中，NAV_LAND 命令加載之後:
# 飛機的名義空速設置為 15 m/s，名義油門設為 75%。
# 當飛機離 NAV_LAND 命令中指定的航點距離小於 150m 時，第一條 NAV_LAND_OPTIONS 命令結束，第二條 NAV_LAND_OPTIONS 命令加載，將飛機的名義空速改為 13 m/s，名義油門改為 65%。
# 當飛機離航點距離小於 50m 時，第二條 NAV_LAND_OPTIONS 命令結束，第三條 NAV_LAND_OPTIONS 命令加載，將飛機的名義空速降為 10 m/s，名義油門降為 45%。
# 第三條 NAV_LAND_OPTIONS 永遠不會結束，因為飛機離航點的距離永遠不會小於 0m。因此，飛機將在降落過程中保持 10 m/s 的空速和 45% 的油門。


沒有空速傳感器的降落命令看起來像這樣:

```
NAV_LAND: p1 = 0, alt = 0, lat = 34.158121, -118.166592
NAV_LAND_OPTIONS: p1 = 150, p2 = N/A, p3 = 75, p4 = -3
NAV_LAND_OPTIONS: p1 = 50, p2 = N/A, p3 = 65, p4 = 0
NAV_LAND_OPTIONS: p1 = 0, p2 = N/A, p3 = 45, p4 = 3
```

這個任務執行情況與上面的例子相同，除了在飛行中 APM 不再監視和減小空速，而是監視和增加仰角。
'></a>