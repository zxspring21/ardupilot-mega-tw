## APM 任務命令 ##

APM 中的命令存在層次。高緊急程度的命令先於其他低緊急的程度命令並立即執行。當處理器空閒時將執行低緊急程度的命令。

高緊急程度的命令的例子有: 讀取遙控操縱桿位置，穩定飛行狀態。

中緊急程度的命令的例子有: 導航計算，發送遙測數據。

低緊急程度的命令（可延遲）的例子有: 讀取遙控飛行狀態切換, 將數據記錄到 APM 的存儲器中。

該命令層次在軟件上是這樣實現的：A) 高、中、低循環 和 B) a command bumping

APM v1.0 固件為自動飛行模式增加了一個新的"命令"隊列，而不是 ArduPilot 中用的"航點"隊列

命令有3種不同的優先級。它們是:

  * 1級 - 命令完成之後才執行其它1級命令。例如, 命令 0x10 是一條導航至一個航點的命令。
  * 2級 - 命令可能完成，也可能被先完成的1級命令清除。例如, 命令 0x20 要求系統延遲一段時間，然後再執行下一條2級或3級命令。
  * 3級 - 如果得到處理，則命令立即執行。例如，命令 0x40 將巡航空速修改為一個給定值。

當進入自動飛行模式時，程序找出並執行列表中的第一個1級命令。然後程序將查找並順序執行所有2級和3級命令，直到收到下一個1級命令。當執行2級命令時，其他2級和3級命令必須等當前命令執行完畢之後才能執行。

當一個1級命令執行完畢時，所有正在執行的2級命令都將取消，同時在下一個1級命令之前未執行的2級和3級命令都將放棄。

遵循以下規則，你可以非常靈活地規劃任務。

## 命令 ##

| **命令 ID** | **名稱** | **參數 1** | **參數 2** | **參數 3** | **參數 4**|
|:----------|:-------|:---------|:---------|:---------|:--------|
|0x10       |導航至航點   |          |高度        |緯度        |經度       |
|0x11       |盤旋 (無限) |          |高度        |緯度        |經度       |
|0x12       |盤旋 X 圈  |圈數        |高度        |緯度        |經度       |
|0x13       |盤旋 X 時間 |時間 (秒\*10)|高度        |緯度        |經度       |
|0x14       |返航      |          |高度        |緯度        |經度       |
|0x15       |降落      |          |高度        |緯度        |經度       |
|0x16       |起飛      |min pitch (with airspeed), desired pitch without airspeed|高度        |          |         |
|0x20       |延遲下一條命令 |時間 (秒)    |          |          |         |
|0x21       |增加/減小 at rate|rate (cm/sec)|alt (finish)|          |         |
|0x30       |改變飛行模式  |模式 #      |          |          |         |
|0x31       |Reset command index to 1|          |          |          |         |
|0x32       |查詢變量 X  |變量 ID     |          |          |         |
|0x33       |廣播變量 x  |變量 ID     |          |          |         |
|0x34       |開/關無線   |關/開 = 0/1 |          |          |         |
|0x40       |改變巡航速率  |巡航速率      |          |          |         |
|0x41       |改變巡航油門  |巡航油門      |          |          |         |
|0x42       |重置返航點   |高度        |緯度        |經度        |         |
|0x60       |Change Kp gain value|array index|gain value **100,000**|          |         |
|0x61       |Change Ki gain value|array index|gain value **100,000**|          |         |
|0x62       |Change Kd gain value|array index|gain value **100,000**|          |         |
|0x63       |Change Integrator max|array index|gain value **100,000**|          |         |
|0x64       |Change Kff gain value|array index|gain value **100,000**|          |         |
|0x70       |改變遙控通道中點|array index|value     |          |         |
|0x71       |改變遙控通道最大值|array index|value     |          |         |
|0x72       |改變遙控通道最大小|array index|value     |          |         |
|0x73       |Change other radio|array index|value    (index 0=elevon 1 trim, 1=elevon 2 trim, 2=ch3\_fs)|          |         |
|0x75       |Change the current command index|array index|value     |          |         |
|0x80       |重複執行某事件 |事件 id     |值         |延遲時間(秒)   |重複次數 (0 = 永久)|
|0x81       |設置繼電器   |0 或 1     |          |          |         |
|0x82       |設置舵機#的脈寬信號|0 - 7     |0 - 2000 (PWM)|          |         |

重複事件的事件Id為:

  * CH\_4\_TOGGLE
  * CH\_5\_TOGGLE
  * CH\_6\_TOGGLE
  * CH\_7\_TOGGLE
  * CH\_8\_TOGGLE
  * RELAY\_TOGGLE

舵機觸發先讀取當前舵機的位置，然後將舵機驅動到設定的位置。1秒之後舵機返回之前保存的位置。